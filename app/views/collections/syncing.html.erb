<% @meta_title = "#{@collection}" %>
<% @meta_description = "Syncing #{@collection}" %>

<%= render 'collection_header' %>
<div class="container">

  <div class="well p-4">
    <div class="d-flex justify-content-between align-items-start mb-3">
      <h1><%= bootstrap_icon 'arrow-down-up',
      width: 36, height: 36, aria_hidden: 'true', focusable: 'false', role: 'img',  title: 'Last synced', class: 'flex-shrink-0 me-3'
      %>Syncing data</h1>
      <% if Rails.env.development? %>
        <%= link_to 'Manual Sync', sync_collection_path(@collection), method: :get, class: 'btn btn-outline-primary btn-sm' %>
      <% end %>
    </div>

    <% if @collection.status == 'error' %>
      <p class="text-danger">‚ùå An error occurred while syncing this collection.</p>
    <% else %>
      <p>Currently syncing this collection. This may take a few minutes.</p>
    <% end %>
    
    <div class="mt-3">
      <strong>Status:</strong> 
      <span class="badge <%= @collection.status == 'error' ? 'bg-danger' : 'bg-warning text-dark' %>"><%= @collection.status %></span>
    </div>

    <% if @collection.status == 'error' && @collection.last_error_message.present? %>
      <div class="mt-4">
        <h5>Error Details</h5>
        <div class="alert alert-danger">
          <strong>Error:</strong> <%= @collection.last_error_message %>
          <% if @collection.last_error_at.present? %>
            <br><small class="text-muted">Occurred at: <%= @collection.last_error_at.strftime('%B %d, %Y at %I:%M %p') %></small>
          <% end %>
        </div>
        
        <% if Rails.env.development? && @collection.last_error_backtrace.present? %>
          <details>
            <summary>Backtrace (Development Only)</summary>
            <pre class="mt-2 p-3 bg-light border rounded"><%= @collection.last_error_backtrace %></pre>
          </details>
        <% end %>
      </div>
    <% end %>
  </div>

</div>