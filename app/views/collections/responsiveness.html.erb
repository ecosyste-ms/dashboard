<% @meta_title = "#{@collection} - Responsiveness" %>
<% @meta_description = "Project responsiveness metrics for #{@collection} including issue and pull request response times" %>
<%= render 'collection_header' %>
<div class="container">

  <div class="dashboard-layout">
    <%= render 'nav' %>

    <div class="dashboard-layout__dboard">
     <div class="dboard__title-bar d-flex justify-content-between align-items-center mb-4">
        <div>
          <h1>Responsiveness</h1>
          <p class="text-muted">Data about how quickly this community responds to demands placed upon it</p>
        </div>
        <%= render 'bots' %>
      </div>
      <%= render 'date_nav' %>

      <div class="dashboard-grid">
        <div class="full-width-widget">
          <div class="card well p-3 border-0">
            <div class="card-body">
              <h5 class="card-title">Resolution Trends</h5>
              <div class="chart-wrapper">
                <canvas 
                  id="responsivenessChart" 
                  width="600"
                  data-chart="line"
                  data-chart-data='<%= {
                    labels: @closed_issues_per_period.map(&:first),
                    datasets: [
                      {
                        label: "Issues Closed",
                        data: @closed_issues_per_period.map(&:last),
                        borderColor: "rgb(75, 192, 192)",
                        backgroundColor: "rgba(75, 192, 192, 0.1)",
                        borderWidth: 3,
                        pointRadius: 3,
                        tension: 0.4,
                        fill: true
                      },
                      {
                        label: "PRs Merged",
                        data: @merged_prs_per_period.map(&:last),
                        borderColor: "rgb(153, 102, 255)",
                        backgroundColor: "rgba(153, 102, 255, 0.1)",
                        borderWidth: 3,
                        pointRadius: 3,
                        tension: 0.4,
                        fill: true
                      }
                    ]
                  }.to_json.html_safe %>'
                  data-chart-options='<%= {
                    scales: {
                      y: {
                        beginAtZero: true,
                        max: ([@closed_issues_per_period.map(&:last).max.to_i, @merged_prs_per_period.map(&:last).max.to_i].max * 1.1).ceil
                      }
                    }
                  }.to_json.html_safe %>'
                ></canvas>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Row 1: Three equal widgets -->
        <div class="three-equal-widgets">
          <%= small_widget 'Time to close PRs', @time_to_close_prs_this_period, @time_to_close_prs_last_period, symbol: ' days', increase_good: false %>
          <%= small_widget 'Merged PRs', @merged_prs_this_period, @merged_prs_last_period, symbol: '', increase_good: true %>
          <%= small_widget 'Unique PR authors', @unique_pr_authors_this_period, @unique_pr_authors_last_period, symbol: '', increase_good: true %>
        </div>
        <div class="three-equal-widgets">
            <%= small_widget 'Time to close issues', @time_to_close_issues_this_period, @time_to_close_issues_last_period, symbol: ' days', increase_good: false  %>
          <%= small_widget 'Closed issues', @closed_issues_this_period, @closed_issues_last_period, symbol: '', increase_good: true %>
          <%= small_widget 'Unique issue authors', @unique_issue_authors_this_period, @unique_issue_authors_last_period, symbol: '', increase_good: true %>
        </div>
      </div>
    </div>
  </div>
</div>